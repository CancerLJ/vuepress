<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>vue项目中使用protobuf | 喵巨人笔记</title>
    <meta name="description" content="vue-cli脚手架搭建的vue项目中使用protobuf">
    <link rel="icon" href="/favicon.ico">
    <meta name="keywords" content="喵巨人,前端,前端开发,JavaScript,vue,vue-cli,json,protobuf,protobuf.js">
    <link rel="preload" href="/assets/css/0.styles.737906f3.css" as="style"><link rel="preload" href="/assets/js/app.373ebcd7.js" as="script"><link rel="preload" href="/assets/js/3.bfdcfffd.js" as="script"><link rel="preload" href="/assets/js/58.736d163d.js" as="script"><link rel="prefetch" href="/assets/js/1.2bae9d15.js"><link rel="prefetch" href="/assets/js/10.c7e5de1e.js"><link rel="prefetch" href="/assets/js/11.947faf55.js"><link rel="prefetch" href="/assets/js/12.2472fbdd.js"><link rel="prefetch" href="/assets/js/13.9e618bf6.js"><link rel="prefetch" href="/assets/js/14.0356e7d9.js"><link rel="prefetch" href="/assets/js/15.3c111c61.js"><link rel="prefetch" href="/assets/js/16.b9482d17.js"><link rel="prefetch" href="/assets/js/17.98b647f1.js"><link rel="prefetch" href="/assets/js/18.76c49e99.js"><link rel="prefetch" href="/assets/js/19.1c20d10f.js"><link rel="prefetch" href="/assets/js/20.dc70c8fc.js"><link rel="prefetch" href="/assets/js/21.467ebb2d.js"><link rel="prefetch" href="/assets/js/22.b0a1d0f3.js"><link rel="prefetch" href="/assets/js/23.b00a4bf6.js"><link rel="prefetch" href="/assets/js/24.ca272cf3.js"><link rel="prefetch" href="/assets/js/25.14adbaf7.js"><link rel="prefetch" href="/assets/js/26.f97564e3.js"><link rel="prefetch" href="/assets/js/27.8e4bdef8.js"><link rel="prefetch" href="/assets/js/28.82f93745.js"><link rel="prefetch" href="/assets/js/29.987f527d.js"><link rel="prefetch" href="/assets/js/30.b00d5021.js"><link rel="prefetch" href="/assets/js/31.0373fca1.js"><link rel="prefetch" href="/assets/js/32.f4b40012.js"><link rel="prefetch" href="/assets/js/33.befd342c.js"><link rel="prefetch" href="/assets/js/34.db1e4f82.js"><link rel="prefetch" href="/assets/js/35.738f4fb7.js"><link rel="prefetch" href="/assets/js/36.06c6d04e.js"><link rel="prefetch" href="/assets/js/37.984d486d.js"><link rel="prefetch" href="/assets/js/38.b68b4bc8.js"><link rel="prefetch" href="/assets/js/39.58b551b7.js"><link rel="prefetch" href="/assets/js/4.730b44f6.js"><link rel="prefetch" href="/assets/js/40.e430db82.js"><link rel="prefetch" href="/assets/js/41.e9743d5e.js"><link rel="prefetch" href="/assets/js/42.3971888d.js"><link rel="prefetch" href="/assets/js/43.656a7310.js"><link rel="prefetch" href="/assets/js/44.9fa3cf39.js"><link rel="prefetch" href="/assets/js/45.cd770c5b.js"><link rel="prefetch" href="/assets/js/46.15edd465.js"><link rel="prefetch" href="/assets/js/47.3e4c8435.js"><link rel="prefetch" href="/assets/js/48.20578371.js"><link rel="prefetch" href="/assets/js/49.16e33620.js"><link rel="prefetch" href="/assets/js/5.34ad1117.js"><link rel="prefetch" href="/assets/js/50.342ff260.js"><link rel="prefetch" href="/assets/js/51.521f5e9b.js"><link rel="prefetch" href="/assets/js/52.6a76ec0a.js"><link rel="prefetch" href="/assets/js/53.69444c3a.js"><link rel="prefetch" href="/assets/js/54.07b58fd5.js"><link rel="prefetch" href="/assets/js/55.8f53b56c.js"><link rel="prefetch" href="/assets/js/56.19c3bd08.js"><link rel="prefetch" href="/assets/js/57.73b77cef.js"><link rel="prefetch" href="/assets/js/59.260f8893.js"><link rel="prefetch" href="/assets/js/6.7846ba7f.js"><link rel="prefetch" href="/assets/js/60.31913508.js"><link rel="prefetch" href="/assets/js/61.044fc743.js"><link rel="prefetch" href="/assets/js/62.e1cdd68a.js"><link rel="prefetch" href="/assets/js/63.46360f15.js"><link rel="prefetch" href="/assets/js/64.97176203.js"><link rel="prefetch" href="/assets/js/65.2103cfda.js"><link rel="prefetch" href="/assets/js/66.9a7763c9.js"><link rel="prefetch" href="/assets/js/67.1c1bc12c.js"><link rel="prefetch" href="/assets/js/68.ec583a59.js"><link rel="prefetch" href="/assets/js/69.dc6b9224.js"><link rel="prefetch" href="/assets/js/7.2d505d86.js"><link rel="prefetch" href="/assets/js/70.6720396d.js"><link rel="prefetch" href="/assets/js/71.649f88b5.js"><link rel="prefetch" href="/assets/js/72.fd020fed.js"><link rel="prefetch" href="/assets/js/73.1a58133e.js"><link rel="prefetch" href="/assets/js/74.ce0c5fdf.js"><link rel="prefetch" href="/assets/js/75.10bc575a.js"><link rel="prefetch" href="/assets/js/76.c28e2c30.js"><link rel="prefetch" href="/assets/js/77.4fecac7f.js"><link rel="prefetch" href="/assets/js/78.35acfd0c.js"><link rel="prefetch" href="/assets/js/79.8d634081.js"><link rel="prefetch" href="/assets/js/8.80a2de5f.js"><link rel="prefetch" href="/assets/js/80.fc226694.js"><link rel="prefetch" href="/assets/js/81.ae543107.js"><link rel="prefetch" href="/assets/js/82.336196da.js"><link rel="prefetch" href="/assets/js/83.92783483.js"><link rel="prefetch" href="/assets/js/84.6b5d6b7b.js"><link rel="prefetch" href="/assets/js/85.96cb4fa9.js"><link rel="prefetch" href="/assets/js/86.ccb3db59.js"><link rel="prefetch" href="/assets/js/87.dd5a823e.js"><link rel="prefetch" href="/assets/js/9.e7a537d5.js">
    <link rel="stylesheet" href="/assets/css/0.styles.737906f3.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">喵巨人笔记</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">前端开发</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/前端开发/css/" class="nav-link">CSS</a></li><li class="dropdown-item"><!----> <a href="/前端开发/javascript/" class="nav-link">JavaScript</a></li><li class="dropdown-item"><!----> <a href="/前端开发/vue/" class="nav-link">vue</a></li><li class="dropdown-item"><!----> <a href="/前端开发/nuxt/" class="nav-link">nuxt</a></li><li class="dropdown-item"><!----> <a href="/前端开发/插件/" class="nav-link">插件</a></li><li class="dropdown-item"><!----> <a href="/前端开发/other/" class="nav-link">其他</a></li></ul></div></div><div class="nav-item"><a href="/php/" class="nav-link">php</a></div><div class="nav-item"><a href="/linux/" class="nav-link">linux</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">其他</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/其他/Markdown简介.html" class="nav-link">Markdown简介</a></li></ul></div></div><div class="nav-item"><a href="/关于作者.html" class="nav-link">关于</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">前端开发</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/前端开发/css/" class="nav-link">CSS</a></li><li class="dropdown-item"><!----> <a href="/前端开发/javascript/" class="nav-link">JavaScript</a></li><li class="dropdown-item"><!----> <a href="/前端开发/vue/" class="nav-link">vue</a></li><li class="dropdown-item"><!----> <a href="/前端开发/nuxt/" class="nav-link">nuxt</a></li><li class="dropdown-item"><!----> <a href="/前端开发/插件/" class="nav-link">插件</a></li><li class="dropdown-item"><!----> <a href="/前端开发/other/" class="nav-link">其他</a></li></ul></div></div><div class="nav-item"><a href="/php/" class="nav-link">php</a></div><div class="nav-item"><a href="/linux/" class="nav-link">linux</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">其他</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/其他/Markdown简介.html" class="nav-link">Markdown简介</a></li></ul></div></div><div class="nav-item"><a href="/关于作者.html" class="nav-link">关于</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>vue项目中使用protobuf</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/vue/vue%E9%A1%B9%E7%9B%AE%E4%B8%AD%E4%BD%BF%E7%94%A8protobuf.html#简介" class="sidebar-link">简介</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/vue/vue%E9%A1%B9%E7%9B%AE%E4%B8%AD%E4%BD%BF%E7%94%A8protobuf.html#思路" class="sidebar-link">思路</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/vue/vue%E9%A1%B9%E7%9B%AE%E4%B8%AD%E4%BD%BF%E7%94%A8protobuf.html#步骤" class="sidebar-link">步骤</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/vue/vue%E9%A1%B9%E7%9B%AE%E4%B8%AD%E4%BD%BF%E7%94%A8protobuf.html#插件安装" class="sidebar-link">插件安装</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/vue/vue%E9%A1%B9%E7%9B%AE%E4%B8%AD%E4%BD%BF%E7%94%A8protobuf.html#命令添加" class="sidebar-link">命令添加</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/vue/vue%E9%A1%B9%E7%9B%AE%E4%B8%AD%E4%BD%BF%E7%94%A8protobuf.html#yaml文件处理" class="sidebar-link">yaml文件处理</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/vue/vue%E9%A1%B9%E7%9B%AE%E4%B8%AD%E4%BD%BF%E7%94%A8protobuf.html#ajax封装" class="sidebar-link">ajax封装</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/vue/vue%E9%A1%B9%E7%9B%AE%E4%B8%AD%E4%BD%BF%E7%94%A8protobuf.html#ajax调用" class="sidebar-link">ajax调用</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="vue项目中使用protobuf"><a href="#vue项目中使用protobuf" aria-hidden="true" class="header-anchor">#</a> vue项目中使用protobuf</h1> <h2 id="简介"><a href="#简介" aria-hidden="true" class="header-anchor">#</a> 简介</h2> <p><code>Google Protocol Buffer</code>(简称<code>Protobuf</code>)是一种轻便高效的结构化数据存储格式，平台无关、语言无关、可扩展，可用于通讯协议和数据存储等领域。</p> <blockquote><p>有几个优点：</p> <ol><li>平台无关，语言无关，可扩展；</li> <li>提供了友好的动态库，使用简单;</li> <li>解析速度快，比对应的XML快约20-100倍；</li> <li>序列化数据非常简洁、紧凑，与XML相比，其序列化之后的数据量约为1/3到1/10。</li></ol></blockquote> <h2 id="思路"><a href="#思路" aria-hidden="true" class="header-anchor">#</a> 思路</h2> <ul><li>在使用<code>vue-cli</code>脚手架搭建的<code>Vue</code>项目中使用</li> <li>前端使用<code>protobuf.js</code>这个库来处理<code>proto</code>文件</li> <li>接口请求相关资料是通过<code>yaml</code>文件保存的。前端使用<code>yaml-loader</code>处理</li> <li><code>proto</code>文件和<code>yaml</code>文件由后端开发人员维护，前端直接拿过来用。</li></ul> <h2 id="步骤"><a href="#步骤" aria-hidden="true" class="header-anchor">#</a> 步骤</h2> <h3 id="插件安装"><a href="#插件安装" aria-hidden="true" class="header-anchor">#</a> 插件安装</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">npm</span> i axios protobufjs --save
<span class="token function">npm</span> i yaml-loader --save-dev
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="命令添加"><a href="#命令添加" aria-hidden="true" class="header-anchor">#</a> 命令添加</h3> <ul><li>在<code>src/</code>目录下新建<code>proto/</code>目录</li> <li>将所有的<code>proto</code>文件复制到<code>src/proto/</code>目录下</li> <li>修改<code>package.json</code>文件。在<code>scripts</code>下面添加命令</li></ul> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    <span class="token property">&quot;proto&quot;</span><span class="token operator">:</span> <span class="token string">&quot;pbjs -t json-module -w commonjs -o src/proto/proto.js  src/proto/*.proto&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><blockquote><p>备注：</p> <ul><li>通过此命令，可以将<code>src/proto/</code>目录下的所有<code>proto</code>文件生成一个<code>src/proto/proto.js</code>文件</li> <li>当然也可以生成<code>json</code>文件，但实践证明打包成<code>js</code>模块比较好用</li> <li><code>-w</code>参数可以指定打包js的包装器，这里用的是<code>commonjs</code>，即打包后的<code>js</code>文件是<code>nodejs</code>语法的。使用<code>require</code>、<code>module.exports</code></li> <li>若想使用<code>es6</code>语法，可以将<code>-w</code>参数的<code>commonjs</code>修改成<code>es6</code>。具体配置看<code>protobuf.js</code>文档</li></ul></blockquote> <h3 id="yaml文件处理"><a href="#yaml文件处理" aria-hidden="true" class="header-anchor">#</a> yaml文件处理</h3> <p><code>yaml</code>文件示例</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">commands</span><span class="token punctuation">:</span>
  <span class="token key atrule">UploadCmd.ADVISOR_UPLOAD</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">&quot;UploadInfo&quot;</span>
    <span class="token key atrule">url</span><span class="token punctuation">:</span> <span class="token string">&quot;/advisor/upload&quot;</span>
    <span class="token key atrule">cmd</span><span class="token punctuation">:</span> <span class="token number">0x6401</span>
    <span class="token key atrule">comment</span><span class="token punctuation">:</span> UploadInfo ADVISOR_UPLOAD  port 8811 上传图片或视频 FileExt FileData UseFor 必填
  <span class="token key atrule">UploadCmd.ADVISOR_UPLOAD_RSP</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">&quot;UploadInfo&quot;</span>
    <span class="token key atrule">url</span><span class="token punctuation">:</span> <span class="token string">&quot;/advisor/upload&quot;</span>
    <span class="token key atrule">cmd</span><span class="token punctuation">:</span> <span class="token number">0x6402</span>
    <span class="token key atrule">comment</span><span class="token punctuation">:</span> ADVISOR_UPLOAD_RSP
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><ul><li>在<code>src/</code>目录下新建<code>axios/</code>目录</li> <li>将<code>yaml</code>文件复制到<code>src/axios/</code>目录下</li> <li>修改<code>build/webpack.base.conf.js</code>文件，添加<code>yaml-loader</code>配置</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// ...</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  module<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    rules<span class="token punctuation">:</span> <span class="token punctuation">[</span>
      <span class="token comment">// ...</span>
      <span class="token punctuation">{</span>
        test<span class="token punctuation">:</span> <span class="token regex">/\.yaml$/</span><span class="token punctuation">,</span>
        loader<span class="token punctuation">:</span> <span class="token string">'yaml-loader'</span><span class="token punctuation">,</span>
        include<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'src'</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token comment">// ...</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>引入文件代码</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> yaml <span class="token keyword">from</span> <span class="token string">'json-loader!yaml-loader!./protobuf.yaml'</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>yaml<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="ajax封装"><a href="#ajax封装" aria-hidden="true" class="header-anchor">#</a> ajax封装</h3> <p>在<code>src/axios/</code>目录下新建文件<code>request_pb.js</code></p> <p><code>ajax</code>发起<code>http</code>请求的整个流程：<code>开始调用接口</code> -&gt; <code>request_pb.js将数据变成二进制</code> -&gt; <code>前端真正发起请求</code> -&gt; <code>后端返回二进制的数据</code> -&gt; <code>request_pb.js处理二进制数据</code> -&gt; 获得数据对象</p> <p>接口都是二进制的数据，所以需要设置<code>axios</code>的请求头，使用<code>arraybuffer</code></p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> axios <span class="token keyword">from</span> <span class="token string">'axios'</span>
<span class="token keyword">const</span> httpService <span class="token operator">=</span> axios<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  timeout<span class="token punctuation">:</span> <span class="token number">45000</span><span class="token punctuation">,</span>
  method<span class="token punctuation">:</span> <span class="token string">'post'</span><span class="token punctuation">,</span>
  headers<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token string">'X-Requested-With'</span><span class="token punctuation">:</span> <span class="token string">'XMLHttpRequest'</span><span class="token punctuation">,</span>
    <span class="token string">'Content-Type'</span><span class="token punctuation">:</span> <span class="token string">'application/octet-stream'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  responseType<span class="token punctuation">:</span> <span class="token string">'arraybuffer'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p><code>http_base.proto</code>里面定义了与后端约定的接口枚举、请求体、响应体如下：</p> <div class="language-protobuf line-numbers-mode"><pre class="language-protobuf"><code><span class="token keyword">syntax</span> <span class="token operator">=</span> <span class="token string">&quot;proto3&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">package</span> advisor<span class="token punctuation">;</span>
<span class="token comment">// ...</span>
<span class="token comment">// 请求</span>
<span class="token keyword">message</span> <span class="token class-name">ReqBase</span>
<span class="token punctuation">{</span>
	<span class="token positional-class-name class-name">DeviceBase</span> Dev 	    <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>   <span class="token comment">// 设备信息</span>
	<span class="token builtin">uint64</span>     UserId   <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>   <span class="token comment">// 用户id</span>
	<span class="token builtin">uint32</span>     Cmd 		<span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>   <span class="token comment">// 命令字</span>
	<span class="token builtin">uint64</span>     MsgId 	<span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>   <span class="token comment">// BussnissId，业务号，客户端发起，原样返回</span>
	<span class="token builtin">string</span>     SessionId <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>  <span class="token comment">// SessionId</span>
	<span class="token builtin">bytes</span>      PbBody    <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">;</span>  <span class="token comment">// 数据内容</span>
	<span class="token builtin">string</span>     MsgCtx 	 <span class="token operator">=</span> <span class="token number">7</span><span class="token punctuation">;</span>  <span class="token comment">// 请求描述</span>
<span class="token punctuation">}</span>

<span class="token comment">// 响应</span>
<span class="token keyword">message</span> <span class="token class-name">RetBase</span>
<span class="token punctuation">{</span>
	<span class="token builtin">int32</span>    Code   	<span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// 错误码</span>
	<span class="token builtin">uint64</span>   UserId     <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">// 用户id</span>
	<span class="token builtin">uint32</span>   Cmd 		<span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span> <span class="token comment">// 命令字</span>
	<span class="token builtin">uint64</span>   MsgId 	    <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span> <span class="token comment">// BussnissId，业务号，客户端发起，原样返回</span>
	<span class="token builtin">bytes</span>    PbBody     <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">;</span> <span class="token comment">// 数据内容</span>
	<span class="token builtin">string</span>   MsgCtx 	<span class="token operator">=</span> <span class="token number">7</span><span class="token punctuation">;</span> <span class="token comment">// 错误描述</span>
<span class="token punctuation">}</span>
<span class="token comment">// ...</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><p>在<code>request_pb.js</code>文件中根据约定好的请求体、响应体编写</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 请求体message</span>
<span class="token keyword">const</span> PBMessageRequest <span class="token operator">=</span> protoRoot<span class="token punctuation">.</span><span class="token function">lookup</span><span class="token punctuation">(</span><span class="token string">'advisor.ReqBase'</span><span class="token punctuation">)</span>
<span class="token comment">// 响应体的message</span>
<span class="token keyword">const</span> PBMessageResponse <span class="token operator">=</span> protoRoot<span class="token punctuation">.</span><span class="token function">lookup</span><span class="token punctuation">(</span><span class="token string">'advisor.RetBase'</span><span class="token punctuation">)</span>

<span class="token comment">// 构造公共请求体:PBMessageRequest</span>
<span class="token keyword">const</span> reqData <span class="token operator">=</span> <span class="token punctuation">{</span>
  Dev<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  PbBody<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  SessionId<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
  UserId<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
  Cmd<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
  MsgId<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  MsgCtx<span class="token punctuation">:</span> <span class="token string">''</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p><code>request_pb.js</code>完整代码如下：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> axios <span class="token keyword">from</span> <span class="token string">'axios'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> protoRoot <span class="token keyword">from</span> <span class="token string">'@/proto/proto'</span>
<span class="token keyword">import</span> protobuf <span class="token keyword">from</span> <span class="token string">'protobufjs'</span>
<span class="token keyword">import</span> store <span class="token keyword">from</span> <span class="token string">'@/store'</span>
<span class="token keyword">import</span> Msg <span class="token keyword">from</span> <span class="token string">'@/utils/msg'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> commands <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'json-loader!yaml-loader!./protobuf.yaml'</span>

<span class="token keyword">const</span> httpService <span class="token operator">=</span> axios<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  timeout<span class="token punctuation">:</span> <span class="token number">45000</span><span class="token punctuation">,</span>
  method<span class="token punctuation">:</span> <span class="token string">'post'</span><span class="token punctuation">,</span>
  baseURL<span class="token punctuation">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span>urlApi_go<span class="token punctuation">,</span>
  headers<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token string">'X-Requested-With'</span><span class="token punctuation">:</span> <span class="token string">'XMLHttpRequest'</span><span class="token punctuation">,</span>
    <span class="token string">'Content-Type'</span><span class="token punctuation">:</span> <span class="token string">'application/octet-stream'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  responseType<span class="token punctuation">:</span> <span class="token string">'arraybuffer'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 请求体message</span>
<span class="token keyword">const</span> PBMessageRequest <span class="token operator">=</span> protoRoot<span class="token punctuation">.</span><span class="token function">lookup</span><span class="token punctuation">(</span><span class="token string">'advisor.ReqBase'</span><span class="token punctuation">)</span>
<span class="token comment">// 响应体的message</span>
<span class="token keyword">const</span> PBMessageResponse <span class="token operator">=</span> protoRoot<span class="token punctuation">.</span><span class="token function">lookup</span><span class="token punctuation">(</span><span class="token string">'advisor.RetBase'</span><span class="token punctuation">)</span>

<span class="token comment">// 将请求数据encode成二进制，encode是proto.js提供的方法</span>
<span class="token keyword">function</span> <span class="token function">transformRequest</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> aa <span class="token operator">=</span> PBMessageRequest<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">finish</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> aa<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">isArrayBuffer</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">'[object ArrayBuffer]'</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">transformResponseFactory</span><span class="token punctuation">(</span><span class="token parameter">responseType<span class="token punctuation">,</span> str</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">transformResponse</span><span class="token punctuation">(</span><span class="token parameter">rawResponse</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 判断response是否是arrayBuffer</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>rawResponse <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> <span class="token operator">!</span><span class="token function">isArrayBuffer</span><span class="token punctuation">(</span>rawResponse<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> rawResponse
    <span class="token punctuation">}</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> buf <span class="token operator">=</span> protobuf<span class="token punctuation">.</span>util<span class="token punctuation">.</span><span class="token function">newBuffer</span><span class="token punctuation">(</span>rawResponse<span class="token punctuation">)</span>
      <span class="token comment">// decode响应体</span>
      <span class="token keyword">const</span> decodedResponse <span class="token operator">=</span> PBMessageResponse<span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>decodedResponse<span class="token punctuation">.</span>Code <span class="token operator">===</span> <span class="token keyword">undefined</span> <span class="token operator">||</span> decodedResponse<span class="token punctuation">.</span>Code <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>decodedResponse<span class="token punctuation">.</span>PbBody <span class="token operator">&amp;&amp;</span> responseType<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">const</span> model <span class="token operator">=</span> protoRoot<span class="token punctuation">.</span><span class="token function">lookup</span><span class="token punctuation">(</span>responseType<span class="token punctuation">)</span>
          decodedResponse<span class="token punctuation">.</span>data <span class="token operator">=</span> model<span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>decodedResponse<span class="token punctuation">.</span>PbBody<span class="token punctuation">)</span>
          decodedResponse<span class="token punctuation">.</span>data <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>decodedResponse<span class="token punctuation">.</span>data<span class="token punctuation">.</span>code <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        decodedResponse<span class="token punctuation">.</span>data <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        decodedResponse<span class="token punctuation">.</span>data<span class="token punctuation">.</span>code <span class="token operator">=</span> decodedResponse<span class="token punctuation">.</span>Code
        decodedResponse<span class="token punctuation">.</span>data<span class="token punctuation">.</span>msg <span class="token operator">=</span> decodedResponse<span class="token punctuation">.</span>Message
      <span class="token punctuation">}</span>
      decodedResponse<span class="token punctuation">.</span>cmd_str <span class="token operator">=</span> str
      <span class="token keyword">return</span> decodedResponse
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> err
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * request
 * @param {*} api 接口名称
 * @param {*} params 请求体参数
 */</span>
<span class="token keyword">function</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token parameter">api<span class="token punctuation">,</span> params</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> pbConstruct <span class="token operator">=</span> protoRoot<span class="token punctuation">.</span><span class="token function">lookup</span><span class="token punctuation">(</span>commands<span class="token punctuation">[</span>api<span class="token punctuation">]</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span>
  <span class="token keyword">const</span> requestBody <span class="token operator">=</span> pbConstruct<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">finish</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token comment">// 构造公共请求体:PBMessageRequest</span>
  <span class="token keyword">const</span> reqData <span class="token operator">=</span> <span class="token punctuation">{</span>
    Dev<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      <span class="token constant">UUID</span><span class="token punctuation">:</span> store<span class="token punctuation">.</span>state<span class="token punctuation">.</span>deviceId <span class="token operator">?</span> store<span class="token punctuation">.</span>state<span class="token punctuation">.</span>deviceId <span class="token punctuation">:</span> <span class="token string">''</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    PbBody<span class="token punctuation">:</span> requestBody<span class="token punctuation">,</span>
    SessionId<span class="token punctuation">:</span> store<span class="token punctuation">.</span>state<span class="token punctuation">.</span>sessionId <span class="token operator">?</span> store<span class="token punctuation">.</span>state<span class="token punctuation">.</span>sessionId <span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
    UserId<span class="token punctuation">:</span> store<span class="token punctuation">.</span>state<span class="token punctuation">.</span>user <span class="token operator">?</span> store<span class="token punctuation">.</span>state<span class="token punctuation">.</span>user<span class="token punctuation">.</span>UserId <span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
    Cmd<span class="token punctuation">:</span> commands<span class="token punctuation">[</span>api<span class="token punctuation">]</span><span class="token punctuation">.</span>cmd<span class="token punctuation">,</span>
    MsgId<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    MsgCtx<span class="token punctuation">:</span> <span class="token string">''</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 将对象序列化成请求体实例</span>
  <span class="token keyword">const</span> req <span class="token operator">=</span> PBMessageRequest<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>reqData<span class="token punctuation">)</span>

  <span class="token comment">// 这里用到axios的配置项：transformRequest和transformResponse</span>
  <span class="token comment">// transformRequest 发起请求时，调用transformRequest方法，目的是将req转换成二进制</span>
  <span class="token comment">// transformResponse 对返回的数据进行处理，目的是将二进制转换成真正的json数据</span>
  <span class="token keyword">return</span> httpService<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span>commands<span class="token punctuation">[</span>api<span class="token punctuation">]</span><span class="token punctuation">.</span>url<span class="token punctuation">,</span> req<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    transformRequest<span class="token punctuation">,</span>
    transformResponse<span class="token punctuation">:</span> <span class="token function">transformResponseFactory</span><span class="token punctuation">(</span>commands<span class="token punctuation">[</span>api<span class="token operator">+</span><span class="token string">'_RSP'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>rspName<span class="token punctuation">,</span> api<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> data<span class="token punctuation">,</span> status <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 对请求做处理</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>status <span class="token operator">!==</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> err <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'服务器异常'</span><span class="token punctuation">)</span>
      Msg<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'服务器异常'</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">throw</span> err
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>data<span class="token punctuation">.</span>Code <span class="token operator">===</span> <span class="token keyword">undefined</span> <span class="token operator">||</span> data<span class="token punctuation">.</span>Code <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> data<span class="token punctuation">.</span>data
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>data<span class="token punctuation">.</span>Code <span class="token operator">===</span> <span class="token number">13001</span> <span class="token operator">||</span> data<span class="token punctuation">.</span>Code <span class="token operator">===</span> <span class="token number">13002</span> <span class="token operator">||</span> data<span class="token punctuation">.</span>Code <span class="token operator">===</span> <span class="token number">13003</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// session out</span>
      Msg<span class="token punctuation">.</span><span class="token function">warning</span><span class="token punctuation">(</span><span class="token string">&quot;Session timeout, sign in again!&quot;</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span>
      store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'setSessionOut'</span><span class="token punctuation">)</span>
      store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'showLogin'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      Msg<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>MsgCtx<span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span>
      <span class="token keyword">return</span> data<span class="token punctuation">.</span>data
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> err
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 在request下添加一个方法，方便用于处理请求参数</span>
request<span class="token punctuation">.</span><span class="token function-variable function">create</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">protoName<span class="token punctuation">,</span> obj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> pbConstruct <span class="token operator">=</span> protoRoot<span class="token punctuation">.</span><span class="token function">lookup</span><span class="token punctuation">(</span>protoName<span class="token punctuation">)</span>
  <span class="token keyword">return</span> pbConstruct<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">finish</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> request
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br></div></div><h3 id="ajax调用"><a href="#ajax调用" aria-hidden="true" class="header-anchor">#</a> ajax调用</h3> <p>调用示例</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> request <span class="token keyword">from</span> <span class="token string">'@/axios/request_pb'</span>

<span class="token keyword">const</span> params <span class="token operator">=</span> <span class="token punctuation">{</span>
  WordKey<span class="token punctuation">:</span> <span class="token string">'keyword'</span><span class="token punctuation">,</span>
  Skip<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  Limit<span class="token punctuation">:</span> <span class="token number">20</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token string">'SearchCmd.FUZZY_SEARCH_ADVISOR'</span><span class="token punctuation">,</span> params<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.373ebcd7.js" defer></script><script src="/assets/js/3.bfdcfffd.js" defer></script><script src="/assets/js/58.736d163d.js" defer></script>
  </body>
</html>
