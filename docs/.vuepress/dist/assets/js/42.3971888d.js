(window.webpackJsonp=window.webpackJsonp||[]).push([[42],{271:function(s,t,a){"use strict";a.r(t);var n=a(2),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"nuxt-js项目部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nuxt-js项目部署","aria-hidden":"true"}},[s._v("#")]),s._v(" Nuxt.js项目部署")]),s._v(" "),a("h2",{attrs:{id:"需求"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#需求","aria-hidden":"true"}},[s._v("#")]),s._v(" 需求")]),s._v(" "),a("p",[a("code",[s._v("Nuxt.js")]),s._v("项目，服务器端框架使用的是"),a("code",[s._v("Koa")]),s._v("。根目录下的"),a("code",[s._v("config/")]),s._v("目录做了多环境相关配置")]),s._v(" "),a("p",[a("code",[s._v("package.json")]),s._v("文件的"),a("code",[s._v("scripts")]),s._v("部分配置如下：")]),s._v(" "),a("div",{staticClass:"language-json line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ...")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"scripts"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"dev"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"cross-env NODE_ENV=development env_config=dev nodemon server/index.js --watch server"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"build:sit"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"cross-env NODE_ENV=production env_config=sit nuxt build"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"start:sit"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"cross-env NODE_ENV=production env_config=sit node server/index.js"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"generate:sit"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"cross-env NODE_ENV=production env_config=sit nuxt generate"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"build:prod"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"cross-env NODE_ENV=production env_config=prod nuxt build"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"start:prod"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"cross-env NODE_ENV=production env_config=prod node server/index.js"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"generate:prod"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"cross-env NODE_ENV=production env_config=prod nuxt generate"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ...")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])]),a("p",[s._v("部署到"),a("code",[s._v("CentOS")]),s._v("服务器上面，使用"),a("code",[s._v("Nginx")]),s._v("做反向代理")]),s._v(" "),a("h2",{attrs:{id:"步骤"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#步骤","aria-hidden":"true"}},[s._v("#")]),s._v(" 步骤")]),s._v(" "),a("h3",{attrs:{id:"node安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#node安装","aria-hidden":"true"}},[s._v("#")]),s._v(" node安装")]),s._v(" "),a("p",[s._v("安装"),a("code",[s._v("nodejs")]),s._v("、"),a("code",[s._v("npm")]),s._v("和脚手架"),a("code",[s._v("vue-cli")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("node -v\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -sL https://rpm.nodesource.com/setup_10.x "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("bash")]),s._v(" -\nyum "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" nodejs -y\nnode -v\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" -v\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" i vue-cli -g\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("h3",{attrs:{id:"文件上传"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#文件上传","aria-hidden":"true"}},[s._v("#")]),s._v(" 文件上传")]),s._v(" "),a("p",[s._v("将项目文件上传到服务器项目目录下，比如："),a("code",[s._v("/data/www/culture")])]),s._v(" "),a("blockquote",[a("p",[s._v("需要上传的目录和文件")]),s._v(" "),a("ul",[a("li",[a("code",[s._v(".nuxt/")]),s._v("：使用"),a("code",[s._v("npm run build:prod")]),s._v("打包生成的")]),s._v(" "),a("li",[a("code",[s._v("config/")]),s._v("：多环境配置目录，没有的话忽略")]),s._v(" "),a("li",[a("code",[s._v("server/")]),s._v("：服务器端不使用默认的"),a("code",[s._v("Nuxt")]),s._v("框架的话，会有此目录")]),s._v(" "),a("li",[a("code",[s._v("static/")]),s._v("：静态文件目录")]),s._v(" "),a("li",[a("code",[s._v("nuxt.config.js")]),s._v("："),a("code",[s._v("nuxt")]),s._v("的配置文件")]),s._v(" "),a("li",[a("code",[s._v("package.json")]),s._v("：配置文件")])])]),s._v(" "),a("h3",{attrs:{id:"nginx配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx配置","aria-hidden":"true"}},[s._v("#")]),s._v(" Nginx配置")]),s._v(" "),a("p",[a("code",[s._v("Nginx")]),s._v("安装自行搜索。这里使用的是"),a("code",[s._v("Tengine")])]),s._v(" "),a("p",[s._v("虚拟主机配置如下：")]),s._v(" "),a("div",{staticClass:"language-nginx line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("upstream")]),s._v(" nodenuxt "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("keepalive")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("listen")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server_name")]),s._v(" xxx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("xxx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_http_version")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" Upgrade "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$http_upgrade")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  \n\t\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" Connection "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"upgrade"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" Host "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" X"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Nginx"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Proxy")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_cache_bypass")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$http_upgrade")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_pass")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("http")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("nodenuxt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br")])]),a("h3",{attrs:{id:"启动项目"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#启动项目","aria-hidden":"true"}},[s._v("#")]),s._v(" 启动项目")]),s._v(" "),a("ul",[a("li",[s._v("切换到项目目录下，安装所需插件"),a("code",[s._v("npm i")])]),s._v(" "),a("li",[s._v("执行命令启动："),a("code",[s._v("npm run start:prod")])]),s._v(" "),a("li",[s._v("浏览器中输入对应的域名就可以访问了")])]),s._v(" "),a("h3",{attrs:{id:"pm2进程守护"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#pm2进程守护","aria-hidden":"true"}},[s._v("#")]),s._v(" pm2进程守护")]),s._v(" "),a("p",[s._v("上述方式进程不能常驻内存。\n使用"),a("code",[s._v("pm2")]),s._v("守护进程")]),s._v(" "),a("ul",[a("li",[s._v("安装"),a("code",[s._v("pm2")]),s._v("："),a("code",[s._v("npm i pm2 -g")])]),s._v(" "),a("li",[s._v("切换到项目目录下，执行命令："),a("code",[s._v('pm2 start npm --name "culture" -- run start:prod')])])]),s._v(" "),a("blockquote",[a("p",[s._v("备注")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("culture")]),s._v("：项目名称，就是"),a("code",[s._v("package.json")]),s._v("文件中的"),a("code",[s._v("name")]),s._v("值")]),s._v(" "),a("li",[a("code",[s._v("run start:prod")]),s._v("：就是执行"),a("code",[s._v("package.json")]),s._v("文件中的"),a("code",[s._v("scripts")]),s._v("配置的命令"),a("code",[s._v("start:prod")])])])]),s._v(" "),a("ul",[a("li",[s._v("启动后可以用"),a("code",[s._v("pm2 list")]),s._v("命令查看进程列表")])]),s._v(" "),a("blockquote",[a("p",[a("strong",[s._v("pm2")]),s._v("常用命令")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("pm2 list")]),s._v("：查看当前正在运行的进程")]),s._v(" "),a("li",[a("code",[s._v("pm2 start all")]),s._v(" ：启动所有应用")]),s._v(" "),a("li",[a("code",[s._v("pm2 restart all")]),s._v(" ：重启所有应用")]),s._v(" "),a("li",[a("code",[s._v("pm2 stop all")]),s._v("：停止所有的应用程序")]),s._v(" "),a("li",[a("code",[s._v("pm2 delete all")]),s._v("：关闭并删除所有应用")]),s._v(" "),a("li",[a("code",[s._v("pm2 logs")]),s._v("：控制台显示所有日志")]),s._v(" "),a("li",[a("code",[s._v("pm2 start 0")]),s._v(" ：启动id为0的指定应用程序")]),s._v(" "),a("li",[a("code",[s._v("pm2 restart 0")]),s._v(" ：重启id为0的指定应用程序")]),s._v(" "),a("li",[a("code",[s._v("pm2 stop 0")]),s._v("：停止id为0的指定应用程序")]),s._v(" "),a("li",[a("code",[s._v("pm2 delete 0")]),s._v("：删除id为0的指定应用程序")]),s._v(" "),a("li",[a("code",[s._v("pm2 logs 0")]),s._v("：控制台显示编号为0的日志")]),s._v(" "),a("li",[a("code",[s._v("pm2 show 0")]),s._v(" ：查看执行编号为0的进程")]),s._v(" "),a("li",[a("code",[s._v("pm2 monit jsyfShopNuxt")]),s._v("：监控名称为jsyfShopNuxt的进程")])])])])}),[],!1,null,null,null);t.default=e.exports}}]);